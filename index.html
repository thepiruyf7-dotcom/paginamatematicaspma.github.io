<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Curso de Matem√°ticas</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-br from-indigo-100 to-purple-200 min-h-screen p-10">

<!-- ====== MEN√ö PRINCIPAL ====== -->
<div id="menu" class="max-w-6xl mx-auto p-8 rounded-3xl shadow-2xl border border-indigo-200 bg-gradient-to-br from-indigo-50 to-purple-100 relative overflow-hidden">

  <div class="absolute inset-0 bg-[url('https://concepto.de/wp-content/uploads/2013/08/matematicas-e1551990322160-800x399.jpg')] bg-repeat opacity-5 animate-[moveBackground_40s_linear_infinite]"></div>

  <style>
    @keyframes moveBackground {
      0% { background-position: 0 0; }
      100% { background-position: 800px 800px; }
    }
  </style>

  <div class="relative z-10">

    <header class="flex flex-col md:flex-row items-center justify-between gap-4 mb-8">
      <div class="text-center md:text-left">
        <h1 class="text-4xl font-extrabold text-indigo-800 drop-shadow-[0_4px_6px_rgba(0,0,0,0.2)] tracking-wide">
          üéì Curso Interactivo de Matem√°ticas
        </h1>
        <p class="text-lg text-indigo-700 mt-2">
          Bienvenido, 
          <span id="userName" class="font-semibold underline decoration-yellow-400 underline-offset-4"></span>!
        </p>
      </div>

      <!-- Bot√≥n para volver al curso de l√≥gica -->
      <button onclick="volverLogica()" 
        class="bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white font-semibold px-6 py-3 rounded-2xl shadow-lg transition transform hover:-translate-y-1 hover:scale-105 duration-200">
        ‚¨Ö Ir al Curso de L√≥gica
      </button>
    </header>

    <!-- Bot√≥n principal -->
    <div class="text-center my-10">
      <button onclick="iniciarMatematicas()" 
        class="group bg-gradient-to-r from-green-300 via-green-400 to-green-500 hover:from-green-400 hover:to-green-600 text-indigo-900 font-bold px-10 py-5 rounded-3xl text-2xl shadow-xl hover:shadow-2xl transition transform hover:-translate-y-1 hover:scale-105 duration-200 flex items-center justify-center mx-auto gap-3">
        üìò <span class="group-hover:translate-x-1 transition-transform">Iniciar Curso: Matem√°ticas</span>
      </button>

      <div class="mt-6">
        <p class="text-indigo-700 text-lg mb-2">
          Progreso total:
          <span id="progressText" class="font-bold text-yellow-600">0%</span>
        </p>

        <div class="w-72 mx-auto bg-indigo-200/40 rounded-full h-4 overflow-hidden shadow-inner backdrop-blur-sm">
          <div id="progressBar" class="bg-yellow-400 h-4 w-0 transition-all duration-700 ease-out rounded-full"></div>
        </div>
      </div>

    </div>

  </div>
</div>



<!-- ===================== LISTA DE CAP√çTULOS ===================== -->
<div id="curso" class="hidden max-w-4xl mx-auto bg-white p-10 mt-10 rounded-3xl shadow-xl">

  <button onclick="volverMenu()" class="text-blue-600 mb-6 hover:underline">
    ‚¨Ö Volver al men√∫
  </button>

  <h2 class="text-3xl font-bold text-green-700 mb-6 text-center">
    Curso de Matem√°ticas
  </h2>

  <div id="listaCapitulos" class="grid md:grid-cols-2 gap-6"></div>
</div>



<!-- ===================== CAP√çTULO ===================== -->
<div id="capitulo" class="hidden max-w-4xl mx-auto bg-white p-10 mt-10 rounded-3xl shadow-xl">

  <button onclick="volverCurso()" class="text-green-600 mb-6 hover:underline">
    ‚¨Ö Volver al curso
  </button>

  <h2 id="tituloCapitulo" class="text-3xl font-bold text-green-700 mb-4"></h2>

  <div id="contenidoCapitulo" class="prose"></div>

  <div class="text-center mt-6">
    <button onclick="mostrarPrueba()" 
      class="bg-green-600 text-white px-6 py-3 rounded-xl shadow hover:bg-green-700">
      üß† Iniciar Prueba
    </button>
  </div>

  <div id="prueba" class="hidden mt-8 border-t pt-4">
    <h3 class="text-xl font-semibold mb-4">Prueba del cap√≠tulo</h3>

    <div id="quiz"></div>

    <button onclick="finalizarPrueba()"
      class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-xl hover:bg-blue-700">
      Finalizar
    </button>

    <button onclick="terminarCapitulo()" 
      class="bg-indigo-600 text-white px-6 py-3 rounded-2xl shadow hover:bg-indigo-700 transition mt-4">
      ‚úî Terminar Cap√≠tulo
    </button>

    <p id="resultado" class="mt-4 text-center font-bold text-lg"></p>
  </div>

</div>






<!-- ============================================================
   SCRIPT COMPLETO
============================================================ -->
<script>

let matematicas = [

/* ============================================================
   CAP√çTULO 0
============================================================ */
{
  id: 0,
  title: "√Ålgebra Universitaria",
  theory: `
    <h3 class="text-xl font-bold">√Ålgebra Universitaria</h3>
    <p>
      El √°lgebra estudia patrones, relaciones y estructuras mediante s√≠mbolos.
    </p>

    <div class="mt-4">
      <h4 class="text-lg font-semibold mb-2">üì∫ Video del cap√≠tulo</h4>
      <div class="w-full">
        <iframe 
          class="w-full h-64 rounded-xl shadow-lg"
          src="https://www.youtube.com/embed/_6uyQISZvBc?start=84"
          allowfullscreen>
        </iframe>
      </div>
    </div>
  `,

  /* === 20 PREGUNTAS === */
  questions: [

    /* Basadas en el video */
    { q: "Seg√∫n el video, ¬øqu√© es el √°lgebra?", a: ["Un m√©todo para medir √°reas", "El estudio de relaciones usando s√≠mbolos", "Una rama de la geometr√≠a"], correct: 1 },
    { q: "El video menciona que una ecuaci√≥n es:", a: ["Una operaci√≥n sin soluci√≥n", "Una comparaci√≥n entre expresiones con un igual", "Una f√≥rmula fija"], correct: 1 },
    { q: "¬øCu√°l es el objetivo del √°lgebra seg√∫n el video?", a: ["Memorizar f√≥rmulas", "Resolver problemas mediante ecuaciones", "Aprender trigonometr√≠a"], correct: 1 },
    { q: "En el video, una variable representa:", a: ["Un n√∫mero desconocido", "Una figura geom√©trica", "Una fracci√≥n"], correct: 0 },
    { q: "El video indica que una expresi√≥n algebraica contiene:", a: ["Solo n√∫meros", "N√∫meros y variables", "Solo letras"], correct: 1 },

    /* Cl√°sicas del √°lgebra b√°sico */
    { q: "Resolver: 3x + 6 = 12", a:["x = 1","x = 2","x = 4"], correct:1 },
    { q: "Factorice: x¬≤ ‚àí 9", a:["(x+3)(x-3)","(x-9)(x+1)","x(x‚àí9)"], correct:0 },
    { q: "Resolver: 5x ‚àí 10 = 0", a:["x = 2","x = -2","x = 10"], correct:0 },
    { q: "Simplifique: 2(x + 3)", a:["2x + 3","2x + 6","x + 5"], correct:1 },
    { q: "¬øCu√°l NO es un t√©rmino algebraico?", a:["4x","7","x + y"], correct:2 },

    /* √Ålgebra intermedia */
    { q: "Resolver: x/3 = 9", a:["x = 12","x = 27","x = 3"], correct:1 },
    { q: "¬øQu√© representa una potencia?", a:["Una multiplicaci√≥n repetida","Una suma repetida","Una ra√≠z"], correct:0 },
    { q: "¬øCu√°l es la ra√≠z cuadrada de 81?", a:["9","8","7"], correct:0 },
    { q: "Resolver: 4x + 2x = 24", a:["x = 2","x = 4","x = 6"], correct:2 },
    { q: "En la expresi√≥n 7x, 7 es:", a:["La variable","El exponente","El coeficiente"], correct:2 },

    /* Ecuaciones simples */
    { q: "Resolver: x ‚àí 15 = 5", a:["x = 20","x = 10","x = -20"], correct:0 },
    { q: "Convertir a expresi√≥n algebraica: 'el doble de un n√∫mero'", a:["2 + x","2x","x/2"], correct:1 },
    { q: "Resolver: 12 = 3(x ‚àí 2)", a:["x = 4","x = 2","x = 6"], correct:0 },
    { q: "¬øCu√°l es la inversa multiplicativa de 5?", a:["5","1/5","-5"], correct:1 },
    { q: "Si 2x = 14, entonces x =", a:["5","6","7"], correct:2 }
  ]
},



/* ============================================================
   CAP√çTULO 1
============================================================ */
{
  id: 1,
  title: "Funciones y Gr√°ficas",
  theory: `
    <h3 class="text-xl font-bold">Funciones y sus Representaciones</h3>
    <p>Una funci√≥n asigna a cada valor de entrada un √∫nico valor de salida.</p>

    <div class="mt-4">
      <h4 class="text-lg font-semibold mb-2">üì∫ Video del cap√≠tulo</h4>
      <div class="w-full">
        <iframe 
          class="w-full h-64 rounded-xl shadow-lg"
          src="https://www.youtube.com/embed/ZCOQFFtGY3I?start=8"
          allowfullscreen>
        </iframe>
      </div>
    </div>
  `,

  /* ======== 20 PREGUNTAS COMPLETAS ======== */
  questions: [

    // Basadas en el video
    { q:"¬øQu√© prueba se usa para saber si una gr√°fica es funci√≥n?", a:["Prueba del eje horizontal","Prueba de la recta vertical","Prueba de simetr√≠a"], correct:1 },
    { q:"Una gr√°fica representa:", a:["Valores m√°ximos","Las parejas (x,y) v√°lidas","Solo n√∫meros enteros"], correct:1 },
    { q:"Seg√∫n el video, una funci√≥n es:", a:["Una tabla","Una correspondencia √∫nica entre entradas y salidas","Una ecuaci√≥n lineal"], correct:1 },
    { q:"Una funci√≥n asigna:", a:["Muchos valores de salida por entrada","Un valor √∫nico por entrada","Solo n√∫meros positivos"], correct:1 },
    { q:"El video explica que una relaci√≥n NO es funci√≥n cuando:", a:["Pasa la prueba de la recta vertical","Falla la prueba de la recta vertical","Tiene dominio infinito"], correct:1 },

    // Contenido extra
    { q:"La funci√≥n f(x)=2x+3 es:", a:["Lineal","Cuadr√°tica","Exponencial"], correct:0 },
    { q:"El dominio de una funci√≥n es:", a:["Valores de salida","Valores de entrada","La pendiente"], correct:1 },
    { q:"La imagen o rango de una funci√≥n es:", a:["Los valores que toma la variable dependiente","Los valores de entrada","Los n√∫meros negativos"], correct:0 },
    { q:"Si f(x)=x¬≤, entonces f(3)=", a:["6","9","3"], correct:1 },
    { q:"Una tabla de valores sirve para:", a:["Ver puntos de una funci√≥n","Medir √°ngulos","Resolver ra√≠ces"], correct:0 },

    // Nivel medio
    { q:"Si una gr√°fica tiene dos puntos con la misma x pero diferente y, entonces:", a:["Es funci√≥n","No es funci√≥n","Es siempre lineal"], correct:1 },
    { q:"La pendiente de una funci√≥n lineal representa:", a:["Su inclinaci√≥n","Su altura","Su dominio"], correct:0 },
    { q:"El punto donde una gr√°fica cruza el eje Y es:", a:["La pendiente","La ra√≠z","El intercepto"], correct:2 },
    { q:"Si f(x)=5, entonces es una funci√≥n:", a:["Constante","Lineal","Cuadr√°tica"], correct:0 },
    { q:"Una funci√≥n cuadr√°tica tiene forma de:", a:["Recta","Par√°bola","Circunferencia"], correct:1 },

    // Preguntas extra para completar 20
    { q:"Para graficar f(x)=3x, basta con:", a:["Trazar 10 puntos","Trazar 2 puntos y unirlos","Usar un comp√°s"], correct:1 },
    { q:"En una funci√≥n, la variable independiente suele llamarse:", a:["y","x","z"], correct:1 },
    { q:"Si una funci√≥n modela temperatura vs tiempo, el dominio es:", a:["La temperatura","El tiempo","El clima"], correct:1 },
    { q:"Si f(x)=x+1 y g(x)=2x, entonces f(2)+g(2)=", a:["6","7","8"], correct:2 },
    { q:"Una gr√°fica creciente significa que:", a:["Aumenta cuando x aumenta","Disminuye cuando x aumenta","No cambia"], correct:0 }
  ]
},



/* ============================================================
   CAP√çTULO 2
============================================================ */
{
  id: 2,
  title: "Trigonometr√≠a",
  theory: `
    <h3 class="text-xl font-bold">Trigonometr√≠a B√°sica</h3>
    <p>Relaciones entre lados y √°ngulos de un tri√°ngulo rect√°ngulo.</p>

    <div class="mt-4">
      <h4 class="text-lg font-semibold mb-2">üì∫ Video recomendado</h4>
      <div class="w-full">
        <iframe 
          class="w-full h-64 rounded-xl shadow-lg"
          src="https://www.youtube.com/embed/ZyLz5SUMzNY?start=27"
          allowfullscreen>
        </iframe>
      </div>
    </div>
  `,

  /* ========= 20 PREGUNTAS ========= */
  questions: [
    // Basadas en el video
    { q:"¬øCu√°l es opuesto/hipotenusa?", a:["Seno","Coseno","Tangente"], correct:0 },
    { q:"¬øCu√°l es adyacente/hipotenusa?", a:["Seno","Coseno","Tangente"], correct:1 },
    { q:"La tangente es:", a:["opuesto/hipotenusa","adyacente/opuesto","opuesto/adyacente"], correct:2 },
    { q:"¬øQu√© tri√°ngulo se usa en el video?", a:["Is√≥sceles","Rect√°ngulo","Escaleno"], correct:1 },
    { q:"180¬∞ equivalen a:", a:["œÄ rad","2œÄ rad","œÄ/2 rad"], correct:0 },
    { q:"sin(Œ∏) se define como:", a:["opuesto/hipotenusa","adyacente/hipotenusa","opuesto/adyacente"], correct:0 },
    { q:"œÄ radianes equivalen a:", a:["90¬∞","180¬∞","360¬∞"], correct:1 },

    // Trigonometr√≠a b√°sica
    { q:"cos(Œ∏) se define como:", a:["opuesto/hipotenusa","adyacente/hipotenusa","hipotenusa/adyacente"], correct:1 },
    { q:"tan(Œ∏) se define como:", a:["opuesto/adyacente","adyacente/opuesto","hipotenusa/opuesto"], correct:0 },
    { q:"En un tri√°ngulo rect√°ngulo, el lado m√°s largo es:", a:["Cateto adyacente","Cateto opuesto","Hipotenusa"], correct:2 },
    { q:"Un √°ngulo recto mide:", a:["45¬∞","90¬∞","180¬∞"], correct:1 },
    { q:"Un tri√°ngulo rect√°ngulo tiene:", a:["1 √°ngulo de 90¬∞","2 √°ngulos de 90¬∞","Ninguno"], correct:0 },

    // Nivel medio
    { q:"Si sin(Œ∏)=0, entonces Œ∏ puede ser:", a:["90¬∞","0¬∞","45¬∞"], correct:1 },
    { q:"Si cos(Œ∏)=0, entonces Œ∏ puede ser:", a:["90¬∞","0¬∞","180¬∞"], correct:0 },
    { q:"Si un tri√°ngulo tiene lados 3, 4 y 5, es:", a:["Is√≥sceles","Escaleno","Rect√°ngulo"], correct:2 },
    { q:"La raz√≥n opuesto/adyacente corresponde a:", a:["seno","coseno","tangente"], correct:2 },
    { q:"¬øCu√°l es la funci√≥n inversa del seno?", a:["arcoseno","arcocoseno","arcotangente"], correct:0 },

    // Extra para completar 20
    { q:"Un radian equivale a:", a:["180¬∞","57.3¬∞","90¬∞"], correct:1 },
    { q:"Si tan(Œ∏)=1, entonces Œ∏ es:", a:["0¬∞","45¬∞","90¬∞"], correct:1 },
    { q:"En trigonometr√≠a, Œ∏ usualmente representa:", a:["Un lado","Un √°ngulo","Una constante"], correct:1 }
  ]
},



/* ============================================================
   CAP√çTULO 3
============================================================ */
{
  id: 3,
  title: "C√°lculo Diferencial",
  theory: `
    <h3 class="text-xl font-bold">Introducci√≥n al C√°lculo Diferencial</h3>
    <p>La derivada mide el cambio instant√°neo de una funci√≥n.</p>

    <div class="mt-4">
      <h4 class="text-lg font-semibold mb-2">üì∫ Video recomendado</h4>
      <div class="w-full">
        <iframe 
          class="w-full h-64 rounded-xl shadow-lg"
          src="https://www.youtube.com/embed/ZSYQ13iMbYA?start=4"
          allowfullscreen>
        </iframe>
      </div>
    </div>
  `,

  /* ========= 20 PREGUNTAS ========= */
  questions: [
    // Del video
    { q:"¬øQu√© representa la derivada?", a:["√Årea","Pendiente de la tangente","Longitud"], correct:1 },
    { q:"La derivada surge del l√≠mite cuando h ‚Üí", a:["‚àû","0","1"], correct:1 },
    { q:"La recta tangente describe:", a:["Variaci√≥n local","√Årea","M√°ximo absoluto"], correct:0 },
    { q:"La derivada indica:", a:["Promedio","Tasa instant√°nea de cambio","Simetr√≠a"], correct:1 },
    { q:"La derivada mide:", a:["√Årea","Cambio instant√°neo","Longitud"], correct:1 },
    { q:"Derivada de x¬≤:", a:["x","2x","x¬≤"], correct:1 },

    // Contenido b√°sico
    { q:"La derivada de una constante es:", a:["1","0","La constante misma"], correct:1 },
    { q:"La derivada de x¬≥ es:", a:["3x¬≤","x¬≤","3x"], correct:0 },
    { q:"La derivada de sen(x) es:", a:["cos(x)","sen(x)","-sen(x)"], correct:0 },
    { q:"La derivada de cos(x) es:", a:["sen(x)","-sen(x)","-cos(x)"], correct:1 },

    // Regla del producto / cociente
    { q:"La regla del producto se usa cuando:", a:["Dos funciones est√°n multiplicadas","Una est√° sumada","Una es constante"], correct:0 },
    { q:"La regla del cociente se usa cuando:", a:["La funci√≥n es una fracci√≥n","La funci√≥n es una suma","La funci√≥n es constante"], correct:0 },
    { q:"Si f(x)=x¬∑sen(x), su derivada empieza como:", a:["x¬∑cos(x)","sen(x)+x¬∑cos(x)","cos(x)"], correct:1 },
    { q:"Para derivar ‚àöx se usa:", a:["Regla de la cadena","Regla del producto","Regla del cociente"], correct:0 },

    // Regla de la cadena
    { q:"La regla de la cadena se aplica cuando:", a:["Hay funciones compuestas","Hay sumas","Hay constantes"], correct:0 },
    { q:"Derivada de (x¬≤ + 1)¬≥:", a:["3(x¬≤+1)¬≤¬∑2x","6x","3x¬≤"], correct:0 },

    // Interpretaci√≥n gr√°fica
    { q:"La pendiente de la recta tangente en un punto representa:", a:["La altura","La aceleraci√≥n instant√°nea","La tasa instant√°nea de cambio"], correct:2 },
    { q:"Si la derivada es positiva:", a:["La funci√≥n crece","La funci√≥n decrece","La funci√≥n es constante"], correct:0 },
    { q:"Si la derivada es cero en un punto:", a:["Posible m√°ximo o m√≠nimo","La funci√≥n explota","No tiene soluci√≥n"], correct:0 },
    { q:"Un punto cr√≠tico es donde:", a:["La derivada es 0 o no existe","La funci√≥n se hace infinita","La funci√≥n est√° en 0"], correct:0 }
  ]
},



/* ============================================================
   CAP√çTULO 4
============================================================ */
{
  id: 4,
  title: "C√°lculo Integral",
  theory: `
    <h3 class="text-xl font-bold">Introducci√≥n al C√°lculo Integral</h3>
    <p>La integral estudia acumulaci√≥n y √°rea bajo la curva.</p>

    <div class="mt-4">
      <h4 class="text-lg font-semibold mb-2">üì∫ Video recomendado</h4>
      <div class="w-full">
        <iframe 
          class="w-full h-64 rounded-xl shadow-lg"
          src="https://www.youtube.com/embed/IaQcGZdadhc?start=35"
          allowfullscreen>
        </iframe>
      </div>
    </div>
  `,

  /* ========= 20 PREGUNTAS ========= */
  questions: [
    // Preguntas del cap√≠tulo original
    { q:"Geom√©tricamente, la integral representa:", a:["Pendiente","√Årea","Longitud"], correct:1 },
    { q:"Una integral definida requiere:", a:["L√≠mites","Derivada","Tri√°ngulo"], correct:0 },
    { q:"Integrar es:", a:["Restar","Sumar infinitesimales","Medir √°ngulos"], correct:1 },
    { q:"El T.F.C relaciona:", a:["Derivadas e integrales","√Åreas","Arcos"], correct:0 },
    { q:"La integral representa:", a:["√Ångulo","√Årea bajo la curva","Pendiente"], correct:1 },
    { q:"Integral de x:", a:["x¬≤/2 + C","1/x + C","2x + C"], correct:0 },

    // Preguntas adicionales
    { q:"La integral indefinida incluye:", a:["L√≠mites","Una constante C","Una derivada"], correct:1 },
    { q:"La derivada de una integral es:", a:["La funci√≥n original","Una constante","El doble"], correct:0 },
    { q:"La integral de una constante k es:", a:["k¬∑x + C","x/k + C","k + C"], correct:0 },
    { q:"‚à´0 dx =", a:["1","x","C"], correct:2 },

    // Interpretaci√≥n y conceptos
    { q:"El √°rea bajo la curva siempre es:", a:["Positiva","Depende del signo de la funci√≥n","Negativa"], correct:1 },
    { q:"El s√≠mbolo ‚à´ representa:", a:["Una suma continua","Una multiplicaci√≥n","Una diferencia"], correct:0 },
    { q:"Las integrales se pueden aproximar con:", a:["Rect√°ngulos","Comp√°s","Pol√≠gonos regulares"], correct:0 },
    { q:"El m√©todo de rect√°ngulos tambi√©n se llama:", a:["M√©todo de Euler","Regla del trapecio","Suma de Riemann"], correct:2 },

    // C√°lculo de integrales b√°sicas
    { q:"‚à´ x¬≤ dx =", a:["x¬≥/3 + C","2x + C","3x¬≤ + C"], correct:0 },
    { q:"‚à´ sen(x) dx =", a:["cos(x) + C","-cos(x) + C","tan(x) + C"], correct:1 },
    { q:"‚à´ cos(x) dx =", a:["sen(x) + C","-sen(x) + C","tan(x) + C"], correct:0 },
    { q:"‚à´ 1/x dx =", a:["ln|x| + C","x + C","1/(x¬≤) + C"], correct:0 },

    // Aplicaciones
    { q:"La integral se usa para calcular:", a:["√Åreas","Velocidades instant√°neas","Primeras derivadas"], correct:0 },
    { q:"La integral definida devuelve:", a:["Un n√∫mero","Una funci√≥n","Un l√≠mite"], correct:0 }
  ]
}


];








/* ============================================================
   SISTEMA DEL CURSO
============================================================ */

let cursoActual = matematicas;
let capituloActual = null;

function iniciarMatematicas() {
  document.getElementById("menu").classList.add("hidden");
  document.getElementById("curso").classList.remove("hidden");

  let lista = document.getElementById("listaCapitulos");
  lista.innerHTML = "";

  cursoActual.forEach(cap => {
    lista.innerHTML += `
      <div onclick="abrirCapitulo(${cap.id})" 
        class="p-5 bg-indigo-100 rounded-xl shadow hover:bg-indigo-200 cursor-pointer">
        <h3 class="font-bold text-lg">${cap.title}</h3>
        <p class="text-sm text-indigo-700 mt-1">Nota: <b>${obtenerNotaMatematicas(cap.id)}</b></p>
      </div>`;
  });
}



function abrirCapitulo(id) {
  capituloActual = cursoActual[id];

  document.getElementById("curso").classList.add("hidden");
  document.getElementById("capitulo").classList.remove("hidden");

  document.getElementById("tituloCapitulo").innerHTML = capituloActual.title;
  document.getElementById("contenidoCapitulo").innerHTML = capituloActual.theory;

  document.getElementById("prueba").classList.add("hidden");
  document.getElementById("resultado").innerHTML = "";

  let progreso = getProgressMatematicas();
  if (!progreso.completed.includes(id)) {
    progreso.completed.push(id);
    saveProgressMatematicas(progreso);
    actualizarBarraProgreso();
  }
}


function mostrarPrueba() {
  let q = capituloActual.questions;
  let quiz = document.getElementById("quiz");
  quiz.innerHTML = "";

  document.getElementById("prueba").classList.remove("hidden");

  q.forEach((p, i) => {
    quiz.innerHTML += `
      <div class="mb-4">
        <p class="font-semibold">${p.q}</p>
        ${p.a.map((opt, j) => `
          <label class="block">
            <input type="radio" name="p${i}" value="${j}"> ${opt}
          </label>
        `).join("")}
      </div>`;
  });
}


function finalizarPrueba() {
  let q = preguntasSeleccionadas;
  let score = 0;

  q.forEach((p, i) => {
    let ans = document.querySelector(`input[name="p${i}"]:checked`);
    if (ans && parseInt(ans.value) === p.correct) score++;
  });

  document.getElementById("resultado").innerHTML =
    `Resultado: <b>${score}/${q.length}</b>`;

  // Guardar nota (8 preguntas)
  saveNotaMatematicas(capituloActual.id, score, q.length);
}



function getProgressMatematicas() {
  let data = localStorage.getItem("progresoMatematicas");
  if (!data) return { completed: [] };
  return JSON.parse(data);
}

function saveProgressMatematicas(progress) {
  localStorage.setItem("progresoMatematicas", JSON.stringify(progress));
}

function actualizarBarraProgreso() {
  let progreso = getProgressMatematicas();
  let total = matematicas.length;
  let completados = progreso.completed.length;

  let porcentaje = Math.round((completados / total) * 100);

  document.getElementById("progressText").innerText = porcentaje + "%";
  document.getElementById("progressBar").style.width = porcentaje + "%";
}

function terminarCapitulo() {
  let q = capituloActual.questions;
  let score = 0;

  // Ver si el usuario ya respondi√≥ algo
  let respondido = false;

  q.forEach((p, i) => {
    let ans = document.querySelector(`input[name="p${i}"]:checked`);
    if (ans) {
      respondido = true;
      if (parseInt(ans.value) === p.correct) score++;
    }
  });

  // Si respondi√≥ al menos 1, se guarda la nota
  if (respondido) {
    saveNotaMatematicas(capituloActual.id, score, q.length);
  }

  // Actualizar progreso del cap√≠tulo
  let progreso = getProgressMatematicas();
  if (!progreso.completed.includes(capituloActual.id)) {
    progreso.completed.push(capituloActual.id);
    saveProgressMatematicas(progreso);
  }

  actualizarBarraProgreso();

  // Regresar a la vista del curso
  document.getElementById("capitulo").classList.add("hidden");
  document.getElementById("curso").classList.remove("hidden");

  // üî• Esto actualiza las notas en los botones
  iniciarMatematicas();
}



function volverMenu() {
  document.getElementById("curso").classList.add("hidden");
  document.getElementById("menu").classList.remove("hidden");
}

function volverCurso() {
  document.getElementById("capitulo").classList.add("hidden");
  document.getElementById("curso").classList.remove("hidden");
}

/* CORREGIDO: antes ten√≠a "github.oi" (error fatal) */
function volverLogica() {
  window.location.href = "https://thepiruyf7-dotcom.github.io/PAGINA-PMA-VIRTUAL-COMPLETA.github.io/";
}



/* ============================================================
   SISTEMA DE NOTAS
============================================================ */

function getNotasMatematicas() {
  let data = localStorage.getItem("notasMatematicas");
  if (!data) return {};  
  return JSON.parse(data);
}

function saveNotaMatematicas(id, score, total) {
  let notas = getNotasMatematicas();
  notas[id] = `${score}/${total}`;
  localStorage.setItem("notasMatematicas", JSON.stringify(notas));
}

function obtenerNotaMatematicas(id) {
  let notas = JSON.parse(localStorage.getItem("notasMatematicas")) || {};

  if (!notas[id]) return "‚Äî";

  let n = notas[id];

  // Si el formato es el nuevo {score: X, total: 8}
  if (typeof n === "object") {
    return `${n.score}/${n.total}`;
  }

  // Si el formato es viejo "2/20"
  if (typeof n === "string") {
    let partes = n.split("/");
    return `${partes[0]}/8`; // <- Forzamos que siempre muestre sobre 8
  }

  return "‚Äî";
}

let preguntasSeleccionadas = [];

function mostrarPrueba() {
  let todas = capituloActual.questions;

  // Mezclar las preguntas (algoritmo Fisher‚ÄìYates)
  let mezcla = [...todas];
  for (let i = mezcla.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [mezcla[i], mezcla[j]] = [mezcla[j], mezcla[i]];
  }

  // Tomar solo 8 preguntas
  preguntasSeleccionadas = mezcla.slice(0, 8);

  let quiz = document.getElementById("quiz");
  quiz.innerHTML = "";
  document.getElementById("prueba").classList.remove("hidden");

  preguntasSeleccionadas.forEach((p, i) => {
    quiz.innerHTML += `
      <div class="mb-4">
        <p class="font-semibold">${p.q}</p>
        ${p.a.map((opt, j) => `
          <label class="block">
            <input type="radio" name="p${i}" value="${j}"> ${opt}
          </label>
        `).join("")}
      </div>`;
  });
}

</script>

</body>
</html>
